<!DOCTYPE html>
<html lang="en">
<head>
  <title>Phones | RMHUB</title>
  <link rel="icon" type="image/x-icon" href="/images/NavImg.jpg">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap 4 -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">

  <style>
    :root{
      --rm-primary:#3cf696;
      --rm-primary-2:#22d67f;
      --rm-ink:#0f172a;
      --rm-muted: rgba(15, 23, 42, 0.65);
      --rm-border: rgba(15, 23, 42, 0.10);
      --rm-shadow: 0 18px 40px rgba(2, 6, 23, 0.12);
      --rm-radius: 18px;
      --rm-radius-lg: 22px;
    }

    body{
      color: var(--rm-ink);
      background:
        radial-gradient(1100px 600px at 15% 10%, rgba(60, 246, 150, 0.22), transparent 55%),
        radial-gradient(900px 500px at 90% 25%, rgba(60, 246, 150, 0.14), transparent 55%),
        #f8f9fa;
    }

    /* Page hero carousel */
    .page-hero{
      margin-top: 16px;
      border-radius: var(--rm-radius-lg);
      overflow: hidden;
      box-shadow: var(--rm-shadow);
      border: 1px solid rgba(255,255,255,0.55);
    }

    .page-hero .carousel-item img{
      width:100%;
      height: 380px;
      object-fit: cover;
    }

    @media(max-width: 767.98px){
      .page-hero .carousel-item img{ height: 260px; }
    }

    /* Header row (title + filter) */
    .page-head{
      margin-top: 18px;
      margin-bottom: 10px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
    }

    .page-title{
      margin:0;
      font-weight: 900;
      letter-spacing: 0.2px;
      font-size: 22px;
    }

    .page-sub{
      margin: 4px 0 0 0;
      color: var(--rm-muted);
      font-weight: 700;
      font-size: 13px;
    }

    .btn-rm{
      border:none;
      border-radius: 14px;
      font-weight: 900;
      padding: 10px 16px;
      color: rgba(15,23,42,0.95);
      background: linear-gradient(135deg, var(--rm-primary), var(--rm-primary-2));
      box-shadow: 0 18px 30px rgba(34, 214, 127, 0.18);
      transition: transform 160ms ease, filter 160ms ease;
      white-space: nowrap;
    }

    .btn-rm:hover{
      transform: translateY(-1px);
      filter: brightness(0.98);
      color: rgba(15,23,42,0.95);
    }

    /* Product cards */
    .product-card{
      position: relative;
      background: rgba(255,255,255,0.86);
      border: 1px solid rgba(255,255,255,0.60);
      border-radius: var(--rm-radius-lg);
      box-shadow: 0 14px 30px rgba(2, 6, 23, 0.10);
      overflow: hidden;
      height: 100%;
      transition: transform 170ms ease, box-shadow 170ms ease;
    }

    .product-card:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 44px rgba(2, 6, 23, 0.14);
    }

    /* IMAGE: fully shown (no cropping) */
    .product-media{
      display:block;
      height: 230px;
      background: #ffffff;
      border-bottom: 1px solid rgba(15,23,42,0.08);
      overflow: hidden;
    }

    .product-media img{
      width: 100%;
      height: 100%;
      object-fit: contain; /* FULL IMAGE */
      padding: 10px;
      transition: transform 180ms ease, filter 180ms ease;
      display:block;
    }

    .product-card:hover .product-media img{
      transform: scale(1.03);
      filter: saturate(1.03);
    }

    .product-body{
      padding: 14px 14px 16px 14px;
    }

    .product-title{
      margin:0;
      font-weight: 900;
      font-size: 15px;
      line-height: 1.25;
      color: rgba(15,23,42,0.95);
    }

    .stock-badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      height: 22px;
      padding: 0 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      background: rgba(15,23,42,0.10);
      color: rgba(15,23,42,0.90);
      white-space: nowrap;
    }

    .product-sub{
      margin: 6px 0 0 0;
      color: var(--rm-muted);
      font-weight: 700;
      font-size: 13px;
      text-align: left;
    }

    .product-desc{
      margin: 8px 0 0 0;
      color: rgba(15,23,42,0.70);
      font-weight: 600;
      font-size: 13px;
      text-align: left;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 40px;
    }

    .rating-row{
      margin-top: 10px;
      display:flex;
      justify-content:flex-start;
      gap: 4px;
    }

    .fas.fa-star.filled{ color: gold; }
    .far.fa-star{ color: rgba(15,23,42,0.65); }

    .price-row{
      margin-top: 10px;
      display:flex;
      align-items: baseline;
      gap: 10px;
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .price-now{
      font-weight: 900;
      font-size: 16px;
      color: rgba(15,23,42,0.95);
    }

    .price-old{
      font-weight: 800;
      font-size: 13px;
      color: rgba(15,23,42,0.55);
      text-decoration: line-through;
    }

    .product-cta{
      margin-top: 12px;
      width: 100%;
      border:none;
      border-radius: 14px;
      font-weight: 900;
      padding: 11px 14px;
      color: rgba(15,23,42,0.95);
      background: linear-gradient(135deg, var(--rm-primary), var(--rm-primary-2));
      transition: transform 160ms ease, filter 160ms ease;
      display:inline-block;
      text-align:center;
      text-decoration:none;
    }

    .product-cta:hover{
      transform: translateY(-1px);
      filter: brightness(0.98);
      color: rgba(15,23,42,0.95);
      text-decoration:none;
    }

    /* Ribbon */
    .ribbon{
      position:absolute;
      top: 12px;
      left: 12px;
      background: linear-gradient(135deg, var(--rm-primary), var(--rm-primary-2));
      color: rgba(15,23,42,0.95);
      font-size: 12px;
      font-weight: 900;
      padding: 6px 10px;
      border-radius: 999px;
      z-index: 3;
      box-shadow: 0 12px 18px rgba(2,6,23,0.10);
      border: 1px solid rgba(255,255,255,0.55);
    }

    /* Wishlist button */
    .wishlist-btn{
      position:absolute;
      top: 12px;
      right: 12px;
      width: 44px;
      height: 44px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.55);
      background: rgba(255,255,255,0.55);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 3;
      cursor:pointer;
      box-shadow: 0 12px 18px rgba(2,6,23,0.08);
      transition: transform 160ms ease, background 160ms ease;
    }

    .wishlist-btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,0.70);
    }

    .add-to-wishlist{
      width: 22px;
      height: 22px;
      fill: transparent;
      transition: transform 160ms ease;
    }

    .add-to-wishlist.fill-heart{
      fill: red;
      transform: scale(1.08);
    }

    /* Mini hearts burst (clean + no broken dataset) */
    .sub-hearts{
      width: 14px;
      position: absolute;
      top: 22px;
      right: 22px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 4;
      fill: var(--rm-primary-2);
      animation: floatOut 900ms ease-in-out forwards;
    }

    @keyframes floatOut{
      from{ transform: translate(-50%, -50%) scale(1); opacity: 1; }
      to{ transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(0.7); opacity: 0; }
    }

    .unlisted-wrap{
      margin: 28px 0;
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(255,255,255,0.60);
      border-radius: var(--rm-radius-lg);
      box-shadow: 0 14px 30px rgba(2, 6, 23, 0.08);
      padding: 18px;
    }
  </style>
</head>

<body>
  <%- include("nav") %>

  <div class="container">

    <!-- HERO CAROUSEL -->
    <div id="carouselExampleIndicators" class="carousel slide page-hero" data-ride="carousel" data-interval="5000">
      <ol class="carousel-indicators">
        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
      </ol>

      <div class="carousel-inner">
        <div class="carousel-item active">
          <img class="d-block w-100" src="/images/phonem.png" alt="Phones slide 1">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100" src="/images/phonem2.png" alt="Phones slide 2">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100" src="/images/phonem3.png" alt="Phones slide 3">
        </div>
      </div>

      <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>

    <!-- TITLE + FILTER -->
    <div class="page-head">
      <div>
        <h2 class="page-title">Phones</h2>
        <p class="page-sub">Latest models, clean pricing, and quick access to product details.</p>
      </div>

      <% if (category.isListed) { %>
        <button id="filterBtn" class="btn-rm"><i class="fas fa-filter mr-2"></i>Filter</button>
      <% } %>
    </div>

    <% if (category.isListed) { %>
      <div class="row">
        <% data1.forEach(element => { %>
          <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3 d-flex">
            <div class="product-card w-100">

              <% if (element.onOffer) { %>
                <div class="ribbon"><%= element.discount %>% OFF</div>
              <% } %>

              <button class="wishlist-btn" type="button" onclick="toggleWishlist('<%= element.id %>')" aria-label="Wishlist">
                <svg id="wishlist-icon-<%= element.id %>"
                     viewBox="0 0 24 22"
                     xmlns="http://www.w3.org/2000/svg"
                     class="add-to-wishlist"
                     data-product-id="<%= element.id %>">
                  <path
                    d="M11.0661 2.81728L11.6026 3.45246L12.1391 2.81728C13.2867 1.45859 15.0479 0.600098 16.8697 0.600098C20.0815 0.600098 22.6051 3.13599 22.6051 6.38807C22.6051 8.38789 21.72 10.2564 20.0229 12.3496C18.3175 14.4529 15.8645 16.6977 12.8407 19.4622L12.826 19.4756L12.8249 19.4766L11.6008 20.6001L10.3798 19.4879L10.3783 19.4866L10.3336 19.4457C7.31862 16.6834 4.87347 14.4409 3.17365 12.3404C1.4821 10.25 0.600098 8.38442 0.600098 6.38807C0.600098 3.13599 3.12361 0.600098 6.33544 0.600098C8.15729 0.600098 9.91845 1.45859 11.0661 2.81728Z"
                    stroke="#0f172a" stroke-width="1" />
                </svg>
              </button>

              <a class="product-media" href="/proddes/<%= element.id %>">
                <img src="<%= element.image[0] %>" alt="<%= element.model %>">
              </a>

              <div class="product-body">
                <div class="d-flex justify-content-between align-items-start" style="gap:10px;">
                  <h3 class="product-title"><%= element.model %></h3>
                  <span class="stock-badge"><%= element.availableStock %></span>
                </div>

                <p class="product-sub">
                  <%= element.color %>
                  <% if (element.category && element.category.name) { %>
                    • <%= element.category.name %>
                  <% } %>
                </p>

                <p class="product-desc"><%= element.description %></p>

                <div class="rating-row">
                  <% for (let i = 1; i <= 5; i++) { %>
                    <% if (i <= element.ratings) { %>
                      <i class="fas fa-star filled"></i>
                    <% } else { %>
                      <i class="far fa-star"></i>
                    <% } %>
                  <% } %>
                </div>

                <div class="price-row">
                  <% if (element.onOffer) { %>
                    <div class="price-now">₹<%= Number(element.offerPrice).toLocaleString('en-IN') %></div>
                    <div class="price-old">₹<%= Number(element.price).toLocaleString('en-IN') %></div>
                  <% } else { %>
                    <div class="price-now">₹<%= Number(element.price).toLocaleString('en-IN') %></div>
                  <% } %>
                </div>

                <a class="product-cta" href="/proddes/<%= element.id %>">Shop now</a>
              </div>

            </div>
          </div>
        <% }); %>
      </div>

    <% } else { %>
      <div class="unlisted-wrap">
        <h5 style="font-weight:900; margin:0 0 6px 0;">Category is currently unlisted</h5>
        <p style="margin:0; color: rgba(15,23,42,0.70); font-weight:700;">
          No products are displayed at the moment.
        </p>
      </div>
    <% } %>

  </div>

  <!-- Filtering Modal -->
  <%- include('phonefiltermodal') %>

  <%- include("footer") %>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="/js/script.js"></script>

  <script>
    // Filter modal
    const filterBtn = document.getElementById('filterBtn');
    if (filterBtn) {
      filterBtn.addEventListener('click', function () {
        $('#PfilterModal').modal('show');
      });
    }

    function burstHearts(btnEl) {
      const parent = btnEl.closest('.product-card');
      if (!parent) return;

      for (let i = 0; i < 7; i++) {
        const h = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        h.setAttribute("viewBox", "0 0 24 22");
        h.classList.add("sub-hearts");

        // random direction
        const dx = (Math.random() * 160 - 80) + "px";
        const dy = (Math.random() * 160 - 80) + "px";
        h.style.setProperty("--dx", dx);
        h.style.setProperty("--dy", dy);

        h.innerHTML = '<path d="M11.0661 2.81728L11.6026 3.45246L12.1391 2.81728C13.2867 1.45859 15.0479 0.600098 16.8697 0.600098C20.0815 0.600098 22.6051 3.13599 22.6051 6.38807C22.6051 8.38789 21.72 10.2564 20.0229 12.3496C18.3175 14.4529 15.8645 16.6977 12.8407 19.4622L12.826 19.4756L12.8249 19.4766L11.6008 20.6001L10.3798 19.4879L10.3783 19.4866L10.3336 19.4457C7.31862 16.6834 4.87347 14.4409 3.17365 12.3404C1.4821 10.25 0.600098 8.38442 0.600098 6.38807C0.600098 3.13599 3.12361 0.600098 6.33544 0.600098C8.15729 0.600098 9.91845 1.45859 11.0661 2.81728Z"/>';
        parent.appendChild(h);

        setTimeout(() => { try { h.remove(); } catch(e){} }, 950);
      }
    }

    async function addToWishlist(productId) {
      const res = await fetch(`/wishlist/addwishlist/${productId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ productId })
      });
      if (!res.ok) throw new Error('Add wishlist failed');
      return res;
    }

    async function removeFromWishlist(productId) {
      const res = await fetch(`/wishlist/removewishlist/${productId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });
      if (!res.ok) throw new Error('Remove wishlist failed');
      return res;
    }

    async function toggleWishlist(productId) {
      const heartIcon = document.getElementById(`wishlist-icon-${productId}`);
      if (!heartIcon) return;

      const isFilled = heartIcon.classList.contains('fill-heart');

      try {
        if (isFilled) {
          await removeFromWishlist(productId);
          heartIcon.classList.remove('fill-heart');
        } else {
          await addToWishlist(productId);
          heartIcon.classList.add('fill-heart');
          burstHearts(heartIcon);
        }
      } catch (err) {
        console.error(err);
      }
    }
  </script>
</body>
</html>
